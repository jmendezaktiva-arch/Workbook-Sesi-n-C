<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workbook Interactivo 2.0 - Sesión C</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
        }
        .brand-blue { color: #00529B; }
        .brand-orange { color: #F68D2E; }
        .bg-brand-blue { background-color: #00529B; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #00529B; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #003f7a; }

        .section-content {
            display: none;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
        }
        .section-content.active {
            display: block;
            opacity: 1;
        }
        .nav-link.active {
            background-color: #eef2ff;
            color: #00529B;
            font-weight: 700;
        }
        .completion-icon {
            transition: all 0.3s ease;
        }
        .instructions-box {
            background-color: #eff6ff;
            border-left: 4px solid #00529B;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        .pro-tip {
            background-color: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin-top: 1.5rem;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        .verdict-button {
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            border: 2px solid transparent;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            font-weight: 700;
        }
        .verdict-button.selected {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .verdict-button.yes { background-color: #dcfce7; border-color: #22c55e; color: #166534; }
        .verdict-button.yes.selected { background-color: #22c55e; color: white; }
        .verdict-button.no { background-color: #fee2e2; border-color: #ef4444; color: #991b1b; }
        .verdict-button.no.selected { background-color: #ef4444; color: white; }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Menú Lateral -->
        <aside class="w-full md:w-80 bg-white shadow-lg p-6 sticky top-0 h-screen overflow-y-auto flex flex-col">
            <div class="flex items-center justify-center mb-6">
                <img src="https://placehold.co/250x100/FFFFFF/00529B?text=Mi+Empresa\nCrece&font=montserrat" alt="Logo Mi Empresa Crece" class="h-20">
            </div>
            
            <div class="mb-6">
                <h4 class="text-sm font-bold text-gray-600 mb-2">Progreso Sesión C</h4>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-brand-blue h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>

            <nav id="nav-menu" class="flex-grow">
                <ul class="space-y-1">
                    <!-- Links de navegación generados por JS -->
                </ul>
            </nav>
            <div class="mt-auto pt-6">
                <button id="export-pdf" class="w-full flex items-center justify-center gap-2 bg-brand-blue text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-800 transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd" /></svg>
                    Exportar a PDF
                </button>
            </div>
             <div id="loading" class="mt-4 text-center" style="display: none;">
                <p class="text-brand-blue animate-pulse">Generando PDF, por favor espera...</p>
            </div>
        </aside>

        <!-- Contenido Principal -->
        <main id="main-content" class="flex-1 p-6 md:p-10 overflow-y-auto">
            <header class="bg-white shadow-md rounded-xl p-6 mb-8">
                <h1 class="text-4xl font-black brand-blue">Workbook Interactivo 2.0</h1>
                <p class="text-lg text-gray-600 mt-2">Sesión C: Gasto Inteligente, Inversiones Efectivas</p>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" placeholder="Nombre del participante" class="autosave-input p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-orange focus:border-transparent transition" data-id="sesionc_nombre_participante">
                    <input type="text" placeholder="Empresa" class="autosave-input p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-orange focus:border-transparent transition" data-id="sesionc_nombre_empresa">
                </div>
            </header>

            <!-- Secciones generadas por JS -->

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mainContent = document.getElementById('main-content');
            const navMenu = document.getElementById('nav-menu').querySelector('ul');
            
            const sectionsData = [
                { id: 'ej1', title: '1. Diagnóstico de Consolidación de Finanzas' },
                { id: 'ej2', title: '2. Plan de Acción a Corto, Mediano y Largo Plazo' },
                { id: 'ej3', title: '3. Diagnóstico de Buenas Prácticas de Gestión' },
                { id: 'ej4', title: '4. Cálculo de Flujo de Caja Libre' },
                { id: 'ej5', title: '5. Análisis Rápido de Prioridades de Negocio' },
                { id: 'ej6', title: '6. Evaluación del Rendimiento' },
                { id: 'ej7', title: '7. Evaluación del Monto' },
                { id: 'ej8', title: '8. Evaluación del Plazo' },
                { id: 'ej9', title: '9. Evaluación del Riesgo' },
                { id: 'ej10', title: '10. Evaluación del Propósito' },
                { id: 'ej11', title: '11. Reporte Rápido de Análisis de Inversión' }
            ];

            sectionsData.forEach(data => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <a href="#${data.id}" class="nav-link flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-100 hover:text-brand-blue transition-colors duration-300 text-sm">
                        <span class="completion-icon text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </span>
                        <span class="flex-grow">${data.title}</span>
                    </a>`;
                navMenu.appendChild(li);

                const section = document.createElement('section');
                section.id = data.id;
                section.className = 'section-content bg-white shadow-xl rounded-2xl p-8 mb-8';
                mainContent.appendChild(section);
            });
            
            document.getElementById('ej1').innerHTML = `
                <h2 class="text-2xl font-bold brand-orange mb-4">${sectionsData[0].title}</h2>
                <div class="instructions-box">
                    <p><strong>Meta Transformacional:</strong> Internalizar que tú no eres la empresa. Crear reglas claras te da libertad y protege tanto tu patrimonio como el negocio.</p>
                </div>
                <div class="space-y-8">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Sección A: Mi Salario como Director</h3>
                        <div class="pro-tip">
                            <p><strong>Pro-Tip del Consultor:</strong> Imagina que tu empresa es adquirida mañana. El nuevo dueño te quiere contratar como Director General. ¿Qué salario negociarías basado en tu experiencia y el valor que aportas? Ese es tu benchmark.</p>
                        </div>
                        <label class="block font-semibold text-gray-700 mt-4">Define tu salario de mercado justo:</label>
                        <input type="text" placeholder="$0.00" class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg" data-section="ej1" data-id="ej1_salario_monto">
                        <textarea placeholder="Justificación..." class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg h-24" data-section="ej1" data-id="ej1_salario_justificacion"></textarea>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Sección B: Mi Política de Dividendos</h3>
                        <p class="mb-4 text-gray-600">Solo retiraré ganancias (dividendos) de la empresa cuando se cumplan estas <strong>dos condiciones SIMULTÁNEAMENTE:</strong></p>
                        <div class="bg-gray-50 p-4 rounded-lg border space-y-4">
                            <div>
                                <label class="font-semibold text-gray-700">1. Condición de Colchón:</label>
                                <p class="text-sm text-gray-500">La cuenta de banco de la empresa debe tener un mínimo de:</p>
                                <input type="number" placeholder="X" class="autosave-input mt-1 w-24 p-2 border border-gray-300 rounded-lg"> 
                                <span class="ml-2">meses de gastos fijos cubiertos.</span>
                            </div>
                            <div>
                                <label class="font-semibold text-gray-700">2. Condición de Excedente:</label>
                                <p class="text-sm text-gray-500">Y solo retiraré un:</p>
                                <input type="number" placeholder="Y" class="autosave-input mt-1 w-24 p-2 border border-gray-300 rounded-lg">
                                <span class="ml-2">% del Flujo de Caja Libre excedente generado en el periodo.</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('ej2').innerHTML = `
                <h2 class="text-2xl font-bold brand-orange mb-4">${sectionsData[1].title}</h2>
                <div class="instructions-box">
                     <p><strong>Meta Transformacional:</strong> Convertir el diagnóstico anterior en un compromiso de ejecución inmediato, asegurando que las nuevas políticas se implementen.</p>
                </div>
                <div class="space-y-6">
                    <h3 class="text-xl font-bold text-gray-800">Compromisos de Profesionalización Financiera</h3>
                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <label class="font-semibold text-gray-700">1. Acción: Comunicar mi nuevo salario.</label>
                        <input type="text" placeholder="¿A quién debo informar (contador, socio, etc.) y para qué fecha?" class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg" data-section="ej2" data-id="ej2_accion1">
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <label class="font-semibold text-gray-700">2. Acción: Formalizar la Política de Dividendos.</label>
                        <input type="text" placeholder="¿Dónde quedará documentada esta política por escrito para que sea una regla oficial?" class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg" data-section="ej2" data-id="ej2_accion2">
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <label class="font-semibold text-gray-700">3. Acción: Implementar el nuevo flujo de pagos.</label>
                        <input type="text" placeholder="¿Cuál es la primera acción concreta para separar los flujos esta semana?" class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg" data-section="ej2" data-id="ej2_accion3">
                    </div>
                </div>
            `;

            document.getElementById('ej3').innerHTML = `
                <h2 class="text-2xl font-bold brand-orange mb-4">${sectionsData[2].title}</h2>
                <div class="instructions-box">
                    <p><strong>Meta Transformacional:</strong> Enfrentar tus sesgos, reconocer tus patrones de decisión impulsivos y comprometerte activamente con un nuevo método.</p>
                </div>
                <div class="space-y-8">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Parte A (El Espejo)</h3>
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <p class="mb-4">Estás en una feria de proveedores y ves una máquina que 'revolucionaría' tu operación. El vendedor te ofrece un 'precio especial de feria' que termina hoy. Honestamente, tu primer impulso es:</p>
                            <div class="space-y-2">
                                <label class="flex items-center p-3 border rounded-lg hover:bg-gray-100 cursor-pointer"><input type="radio" name="impulso" class="form-radio h-5 w-5 text-brand-blue" data-section="ej3" data-id="ej3_espejo_a"> <span class="ml-3">a) Encontrar la forma de no perder la 'oportunidad'.</span></label>
                                <label class="flex items-center p-3 border rounded-lg hover:bg-gray-100 cursor-pointer"><input type="radio" name="impulso" class="form-radio h-5 w-5 text-brand-blue" data-section="ej3" data-id="ej3_espejo_b"> <span class="ml-3">b) Agradecer, tomar el folleto y saber que cualquier buena oferta puede esperar a un buen análisis.</span></label>
                            </div>
                            <input type="text" placeholder="Mi Hábito N°1 a Vencer es..." class="autosave-input mt-4 w-full p-3 border border-gray-300 rounded-lg" data-section="ej3" data-id="ej3_habito">
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Parte B (El Compromiso)</h3>
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <p class="mb-2"><strong>Hábito de Riesgo:</strong> Decidir por impulso/presión.</p>
                            <p class="mb-2"><strong>El Nuevo Método:</strong> Aplicar el Marco 4+1 a toda decisión > $500.</p>
                            <label class="font-semibold text-gray-700">Mi Ancla Visual:</label>
                            <input type="text" placeholder="¿Qué objeto o recordatorio físico pondrás en tu escritorio para forzarte a analizar?" class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg" data-section="ej3" data-id="ej3_ancla">
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('ej4').innerHTML = `
                <h2 class="text-2xl font-bold brand-orange mb-4">${sectionsData[3].title}</h2>
                <div class="instructions-box">
                    <p><strong>Meta Transformacional:</strong> Dejar de guiarte por las ventas "en papel" y entender la cruda realidad del efectivo disponible, el verdadero combustible del negocio.</p>
                </div>
                <div class="space-y-8">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Parte A (Cálculo Exprés)</h3>
                        <div class="pro-tip"><p><strong>Pro-Tip:</strong> ¡Usa tu estado de cuenta bancario, no tu sistema de facturación!</p></div>
                        <!-- Simple calculator could go here -->
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Parte B (Simulador de Vuelo - Test de Estrés)</h3>
                        <p class="text-gray-600 mb-4">¿Qué pasaría con tu FCL si tus ventas cayeran un 20%? ¿El resultado es positivo o negativo?</p>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Conclusión Clave</h3>
                         <div class="bg-gray-50 p-6 rounded-lg border">
                            <label class="font-semibold text-gray-700">Mi 'Oxígeno' (FCL) mensual promedio es:</label>
                            <input type="text" placeholder="$0.00" class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg" data-section="ej4" data-id="ej4_oxigeno">
                            <label class="font-semibold text-gray-700 mt-4 block">Al estresar mis finanzas, mi nivel de alerta es:</label>
                            <div class="flex space-x-4 mt-2">
                                <label class="flex-1 text-center p-3 rounded-lg border-2 border-green-500 bg-green-50 cursor-pointer"><input type="radio" name="alerta" class="hidden"> VERDE</label>
                                <label class="flex-1 text-center p-3 rounded-lg border-2 border-yellow-500 bg-yellow-50 cursor-pointer"><input type="radio" name="alerta" class="hidden"> AMARILLO</label>
                                <label class="flex-1 text-center p-3 rounded-lg border-2 border-red-500 bg-red-50 cursor-pointer"><input type="radio" name="alerta" class="hidden"> ROJO</label>
                            </div>
                         </div>
                    </div>
                </div>
            `;

            document.getElementById('ej5').innerHTML = `
                <h2 class="text-2xl font-bold brand-orange mb-4">${sectionsData[4].title}</h2>
                <div class="instructions-box">
                    <p><strong>Meta Transformacional:</strong> Aprender a enfocar tu energía, pasando de una lista de "cosas por hacer" a identificar LA iniciativa de mayor impacto estratégico.</p>
                </div>
                <div class="space-y-6">
                    <div>
                        <label class="font-semibold text-gray-700">Paso 1: Lluvia de Ideas</label>
                        <textarea placeholder="Enlista 3-5 inversiones o gastos importantes que estés considerando." class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg h-28" data-section="ej5" data-id="ej5_ideas"></textarea>
                    </div>
                     <div>
                        <label class="font-semibold text-gray-700">Paso 2: Matriz de Priorización</label>
                        <p class="text-sm text-gray-500">Ubica tus ideas en la matriz de Impacto vs. Urgencia.</p>
                        <!-- Interactive Matrix could go here -->
                    </div>
                    <div>
                        <label class="font-semibold text-gray-700">Paso 3: La Decisión</label>
                        <div class="pro-tip"><p>Si tienes más de una idea en 'Alto Impacto / Alta Urgencia', pregúntate: ¿Cuál de estas mueve la aguja MÁS RÁPIDO hacia mi visión a 3 años?</p></div>
                        <input type="text" placeholder="Mi Proyecto Prioritario a Analizar es..." class="autosave-input mt-4 w-full p-3 border border-gray-300 rounded-lg" data-section="ej5" data-id="ej5_decision">
                    </div>
                </div>
            `;

            const createFilterExercise = (num, title, transformationalGoal, proTip, content) => {
                 return `
                    <h2 class="text-2xl font-bold brand-orange mb-4">${title}</h2>
                    <div class="instructions-box"><p><strong>Meta Transformacional:</strong> ${transformationalGoal}</p></div>
                    <div class="pro-tip mb-6"><p>${proTip}</p></div>
                    ${content}
                    <div class="mt-8 text-center space-x-4 verdict-container">
                        <h3 class="font-bold text-lg mb-4">Veredicto del Filtro</h3>
                        <button class="verdict-button yes" data-value="SÍ">SÍ</button>
                        <button class="verdict-button no" data-value="NO">NO</button>
                        <input type="hidden" class="autosave-input verdict-input" data-section="ej${num}" data-id="ej${num}_veredicto">
                    </div>
                `;
            };

            document.getElementById('ej6').innerHTML = createFilterExercise(6, sectionsData[5].title, 
                "Aprender a exigir un retorno justo por tu riesgo, aplicando un criterio numérico claro.",
                "Recuerda, este 20% es tu mínimo. Si pudieras invertir este mismo dinero en CETES (~11%) sin hacer nada, ¿no debería tu propio negocio, con todo tu esfuerzo, pagarte al menos el doble?",
                `<div class="bg-gray-50 p-6 rounded-lg border">
                    <label class="font-semibold text-gray-700">Cálculo de ROI Anualizado:</label>
                    <input type="text" placeholder="Introduce el % de ROI Anualizado" class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg" data-section="ej6" data-id="ej6_roi">
                 </div>`
            );
            
            document.getElementById('ej7').innerHTML = createFilterExercise(7, sectionsData[6].title, 
                "Evaluar si puedes pagar el proyecto sin asfixiar la liquidez del negocio.",
                "Si la inversión supera tu umbral (5% de tu FCL Anual), no significa que no puedas hacerla. Significa que debes negociar las condiciones de pago. Usa este dato para pedirle al proveedor un plan que se ajuste a tu capacidad.",
                `<div class="bg-gray-50 p-6 rounded-lg border">
                    <label class="font-semibold text-gray-700">Análisis del Monto:</label>
                    <textarea placeholder="Describe si el monto es manejable y tu estrategia de pago/financiamiento si es necesario." class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg h-24" data-section="ej7" data-id="ej7_analisis"></textarea>
                 </div>`
            );

            document.getElementById('ej8').innerHTML = createFilterExercise(8, sectionsData[7].title,
                "Comprender cómo el tiempo impacta el retorno y aprender a valorar la velocidad para recuperar tu capital.",
                "En el mundo actual, la velocidad es una ventaja competitiva. ¿Este plazo de recuperación te permite mantener la agilidad para capturar la siguiente oportunidad, o inmoviliza tu capital por demasiado tiempo?",
                `<div class="bg-gray-50 p-6 rounded-lg border">
                    <label class="font-semibold text-gray-700">Periodo de Recuperación (Payback):</label>
                    <input type="text" placeholder="Introduce el número de meses" class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg" data-section="ej8" data-id="ej8_payback">
                 </div>`
            );

            document.getElementById('ej9').innerHTML = createFilterExercise(9, sectionsData[8].title,
                "Transformar el miedo a lo desconocido en una gestión proactiva de amenazas.",
                "No se trata de eliminar todos los riesgos, sino de conocerlos y tener un plan para el más importante. La preparación te da confianza.",
                `<div class="bg-gray-50 p-6 rounded-lg border space-y-4">
                    <div>
                        <label class="font-semibold text-gray-700">Parte A (La Prueba de Supervivencia):</label>
                        <p>Si el peor escenario realista ocurre, ¿el negocio sobrevive?</p>
                        <!-- Simple Yes/No toggle -->
                    </div>
                     <div>
                        <label class="font-semibold text-gray-700">Parte B (Radar de Riesgo):</label>
                        <textarea placeholder="Identifica el riesgo principal y la PRIMERA ACCIÓN que puedes tomar para reducirlo." class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg h-24" data-section="ej9" data-id="ej9_radar"></textarea>
                    </div>
                 </div>`
            );

            document.getElementById('ej10').innerHTML = createFilterExercise(10, sectionsData[9].title,
                "Conectar la decisión financiera con el alma de la empresa.",
                "Un proyecto puede ser rentable pero alejarte de tu misión. Este filtro asegura que cada peso invertido construya la empresa que sueñas, no solo una que gana dinero.",
                `<div class="bg-gray-50 p-6 rounded-lg border">
                    <label class="font-semibold text-gray-700">Declaración de Propósito de la Inversión:</label>
                    <textarea placeholder="Completa la frase: Invertir en [Mi Proyecto] es crucial para mi visión a 3 años porque nos permitirá..." class="autosave-input mt-2 w-full p-3 border border-gray-300 rounded-lg h-32" data-section="ej10" data-id="ej10_declaracion"></textarea>
                 </div>`
            );

            document.getElementById('ej11').innerHTML = `
                <h2 class="text-2xl font-bold brand-orange mb-4">${sectionsData[10].title} (One-Pager)</h2>
                <div class="instructions-box">
                    <p><strong>Meta Transformacional:</strong> Equiparte con una herramienta de comunicación y ejecución de alto impacto que resume todo tu análisis.</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg border">
                    <h3 class="text-xl font-bold text-center text-gray-800 mb-4">Caso de Negocio: <span id="onepager_title">[Nombre del Proyecto]</span></h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold">Métricas Clave</h4>
                            <p><strong>ROI Anualizado:</strong> <span id="onepager_roi"></span></p>
                            <p><strong>Monto:</strong> <span id="onepager_monto"></span></p>
                            <p><strong>Plazo (Payback):</strong> <span id="onepager_plazo"></span></p>
                        </div>
                        <div>
                            <h4 class="font-bold">Riesgo y Propósito</h4>
                            <p><strong>Riesgo Principal:</strong> <span id="onepager_riesgo"></span></p>
                            <p><strong>Alineación Estratégica:</strong> <span id="onepager_proposito"></span></p>
                        </div>
                    </div>
                    <div class="text-center mt-6">
                        <h4 class="font-bold">Decisión Final: <span id="onepager_decision" class="text-2xl"></span></h4>
                    </div>
                    <div id="onepager_plan_ejecucion" class="mt-6 hidden">
                        <h4 class="text-lg font-bold text-gray-800 mb-2">Plan de Ejecución Inmediata</h4>
                        <div class="space-y-2">
                             <input type="text" placeholder="Primer Paso (Próximos 7 días)" class="autosave-input w-full p-2 border rounded-md" data-section="ej11" data-id="ej11_paso1">
                             <input type="text" placeholder="Primer Hito (Próximos 30 días)" class="autosave-input w-full p-2 border rounded-md" data-section="ej11" data-id="ej11_hito1">
                             <input type="text" placeholder="Medida de Éxito (En 90 días)" class="autosave-input w-full p-2 border rounded-md" data-section="ej11" data-id="ej11_exito90">
                        </div>
                    </div>
                </div>
            `;

            // --- LÓGICA DE NAVEGACIÓN Y ESTADO ---
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.section-content');

            function showSection(hash) {
                const targetHash = hash || `#${sectionsData[0].id}`;
                sections.forEach(section => section.classList.toggle('active', `#${section.id}` === targetHash));
                navLinks.forEach(link => link.classList.toggle('active', link.getAttribute('href') === targetHash));
            }

            navMenu.addEventListener('click', function(e) {
                const link = e.target.closest('.nav-link');
                if (link) {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    history.pushState(null, null, targetId);
                    showSection(targetId);
                    window.scrollTo(0, 0);
                }
            });
            
            // --- LÓGICA DE COMPLETITUD Y PROGRESO ---
            function checkCompletion() {
                let completedSections = 0;
                sectionsData.forEach(data => {
                    const sectionInputs = document.querySelectorAll(`.autosave-input[data-section="${data.id}"]`);
                    let isComplete = Array.from(sectionInputs).some(input => (input.type === 'checkbox' || input.type === 'radio') ? input.checked : input.value.trim() !== '');
                    
                    const navLink = document.querySelector(`.nav-link[href="#${data.id}"]`);
                    const icon = navLink.querySelector('.completion-icon');
                    if (isComplete) {
                        completedSections++;
                        icon.classList.remove('text-gray-400');
                        icon.classList.add('text-green-500');
                    } else {
                        icon.classList.add('text-gray-400');
                        icon.classList.remove('text-green-500');
                    }
                });
                const progress = (completedSections / sectionsData.length) * 100;
                document.getElementById('progress-bar').style.width = `${progress}%`;
            }

            // --- AUTOSAVE ---
            function loadSavedData() {
                document.querySelectorAll('.autosave-input').forEach(input => {
                    const savedValue = localStorage.getItem('sesionc_' + input.dataset.id);
                    if (savedValue) {
                        if (input.type === 'radio' || input.type === 'checkbox') {
                            if (input.value === savedValue || (input.type === 'checkbox' && savedValue === 'true')) input.checked = true;
                        } else {
                            input.value = savedValue;
                        }
                    }
                });
                checkCompletion();
            }

            mainContent.addEventListener('input', function(e) {
                 if (e.target.classList.contains('autosave-input')) {
                    const input = e.target;
                    const valueToSave = (input.type === 'checkbox') ? input.checked : input.value;
                    localStorage.setItem('sesionc_' + input.dataset.id, valueToSave);
                    checkCompletion();
                 }
            });
             mainContent.addEventListener('change', function(e) {
                 if (e.target.classList.contains('autosave-input') && (e.target.type === 'radio' || e.target.tagName === 'SELECT')) {
                    const input = e.target;
                    localStorage.setItem('sesionc_' + input.dataset.id, input.value);
                    checkCompletion();
                 }
            });

            // --- LÓGICA DE VEREDICTOS ---
            document.querySelectorAll('.verdict-container').forEach(container => {
                const buttons = container.querySelectorAll('.verdict-button');
                const hiddenInput = container.querySelector('.verdict-input');
                buttons.forEach(button => {
                    button.addEventListener('click', () => {
                        buttons.forEach(btn => btn.classList.remove('selected'));
                        button.classList.add('selected');
                        hiddenInput.value = button.dataset.value;
                        // Trigger input event for autosave
                        hiddenInput.dispatchEvent(new Event('input', { bubbles: true }));
                    });
                });
            });


            // --- EXPORTAR A PDF ---
            document.getElementById('export-pdf').addEventListener('click', function() {
                const { jsPDF } = window.jspdf;
                const loadingIndicator = document.getElementById('loading');
                loadingIndicator.style.display = 'block';
                
                const currentHash = window.location.hash;
                sections.forEach(s => s.classList.add('active'));
                
                html2canvas(mainContent, { scale: 2, useCORS: true }).then(canvas => {
                    showSection(currentHash);
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    const ratio = imgHeight / imgWidth;
                    const imgHeightOnPdf = pdfWidth * ratio;
                    let heightLeft = imgHeightOnPdf;
                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeightOnPdf);
                    heightLeft -= pdf.internal.pageSize.getHeight();

                    while (heightLeft > 0) {
                        position -= pdf.internal.pageSize.getHeight();
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeightOnPdf);
                        heightLeft -= pdf.internal.pageSize.getHeight();
                    }

                    const participantName = localStorage.getItem('sesionc_nombre_participante') || 'participante';
                    pdf.save(`Workbook_SesionC_${participantName}.pdf`);
                    loadingIndicator.style.display = 'none';
                }).catch(err => {
                    console.error("Error al generar el PDF:", err);
                    loadingIndicator.style.display = 'none';
                    showSection(currentHash);
                });
            });

            // --- INICIALIZACIÓN FINAL ---
            showSection(window.location.hash);
            loadSavedData();
        });
    </script>

</body>
</html>
